parameters:
  ServiceDirectory: ''

steps:
  - pwsh: |
        $certUri = "https://github.com/Azure/azure-sdk-tools/raw/main/tools/test-proxy/docker/dev_certificate/dotnet-devcert.pfx"
        $certLocation = "$(Build.SourcesDirectory)/dotnet-devcert.pfx"

        Invoke-WebRequest `
            -Uri $certUri `
            -OutFile $certLocation -UseBasicParsing

        dotnet dev-certs https --clean --import $certLocation -p "password"
        dotnet dev-certs https --trust
    displayName: 'Download and Trust Certificate'
    
  - pwsh: |
      docker run `
      --detach `
      -v $(Build.SourcesDirectory):/etc/testproxy `
      -p 5001:5001 `
      -p 5000:5000 `
      azsdkengsys.azurecr.io/engsys/testproxy-lin:latest
    displayName: 'Run the docker container'
    condition: and(succeeded(), ne(variables['Agent.OS'],'Windows_NT'))

  - pwsh: |
      docker run `
      --detach `
      -v $(Build.SourcesDirectory):/etc/testproxy `
      -p 5001:5001 `
      -p 5000:5000 `
      azsdkengsys.azurecr.io/engsys/testproxy-win:latest
    displayName: 'Run the docker container'
    condition: and(succeeded(), eq(variables['Agent.OS'],'Windows_NT'))
    

