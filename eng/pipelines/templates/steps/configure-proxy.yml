parameters:
  ServiceDirectory: ''

steps:
  - pwsh: |
        $certUriPfx = "https://github.com/Azure/azure-sdk-tools/blob/c0d142ae047f0d561a31f9989c63896cc5ffc70e/eng/common/testproxy/dotnet-devcert.pfx"
        $certUriCrt = "https://github.com/Azure/azure-sdk-tools/blob/c0d142ae047f0d561a31f9989c63896cc5ffc70e/eng/common/testproxy/dotnet-devcert.crt"
        $certLocationPfx = "$(Build.SourcesDirectory)/dotnet-devcert.pfx"
        $certLocationCrt = "$(Build.SourcesDirectory)/dotnet-devcert.crt"

        Invoke-WebRequest `
            -Uri $certUriPfx `
            -OutFile $certLocationPfx -UseBasicParsing

        Invoke-WebRequest `
            -Uri $certUriCrt `
            -OutFile $certLocationCrt -UseBasicParsing

        dotnet dev-certs https --clean --import $certLocationPfx -p "password"

        Write-Host "##vso[task.setvariable variable=PROXY_CERT]$certLocationCrt"
    displayName: 'Download and Trust Certificate'
